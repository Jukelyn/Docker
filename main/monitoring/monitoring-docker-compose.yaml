services:
  uptime-kuma:
    image: louislam/uptime-kuma:1
    container_name: kuma
    volumes:
      - ./data/kuma_data:/app/data
      - /var/run/docker.sock:/var/run/docker.sock
    restart: always
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.uptime-kuma.rule=Host(`kuma.jukelyn.com`)"
      - "traefik.http.routers.uptime-kuma.entrypoints=websecure"
      - "traefik.http.routers.uptime-kuma.tls=true"
      - "traefik.http.routers.uptime-kuma.tls.certresolver=porkbun"
      - "traefik.http.services.uptime-kuma.loadBalancer.server.port=3001"
    environment:
      - TZ=America/New_York
    networks:
      - main_kuma_net

  myspeed:
    container_name: myspeed
    image: germannewsmaker/myspeed
    volumes:
      - ./data/myspeed_data:/myspeed/data
    restart: unless-stopped
    networks:
      - main_kuma_net
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.myspeed.rule=Host(`speed.jukelyn.com`)"
      - "traefik.http.routers.myspeed.entrypoints=websecure"
      - "traefik.http.services.myspeed.loadbalancer.server.port=5216"
      - "traefik.http.routers.myspeed.service=myspeed"
      - "traefik.http.routers.myspeed.tls.certresolver=porkbun"

  prometheus:
    container_name: prometheus
    image: prom/prometheus
    volumes:
      - "./configs/prometheus.yml:/etc/prometheus/prometheus.yml"
      - "./configs/rules.yml:/etc/prometheus/rules.yml"
    networks:
      - main_kuma_net
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.prometheus.rule=Host(`prometheus.jukelyn.com`)"
      - "traefik.http.routers.prometheus.entrypoints=websecure"
      - "traefik.http.services.prometheus.loadbalancer.server.port=9090"
      - "traefik.http.routers.prometheus.service=prometheus"
      - "traefik.http.routers.prometheus.tls.certresolver=porkbun"

  node-exporter:
    container_name: node_exporter
    image: prom/node-exporter
    networks:
      - main_kuma_net
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.node_exporter.rule=Host(`node.jukelyn.com`)"
      - "traefik.http.routers.node_exporter.entrypoints=websecure"
      - "traefik.http.services.node_exporter.loadbalancer.server.port=9100"
      - "traefik.http.routers.node_exporter.service=node_exporter"
      - "traefik.http.routers.node_exporter.tls=true"
      - "traefik.http.routers.node_exporter.tls.certresolver=porkbun"

  alert-manager:
    container_name: alert_manager
    image: prom/alertmanager
    volumes:
      - "./configs/alertmanager.yml:/alertmanager/alertmanager.yml"
    networks:
      - main_kuma_net
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.alert_manager.rule=Host(`alert-manager.jukelyn.com`)"
      - "traefik.http.routers.alert_manager.entrypoints=websecure"
      - "traefik.http.services.alert_manager.loadbalancer.server.port=9093"
      - "traefik.http.routers.alert_manager.service=alert_manager"
      - "traefik.http.routers.alert_manager.tls=true"
      - "traefik.http.routers.alert_manager.tls.certresolver=porkbun"

networks:
  main_kuma_net:
    external: true
